<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <link rel="stylesheet" type="text/css" th:href="@{/resources/css/vendor/bootstrap.min.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/resources/css/vendor/bootstrap-select.min.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/resources/css/style.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/resources/css/toggle_checkbox.css}" />
    
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>

    <script src="https://kit.fontawesome.com/5b9febade6.js" crossorigin="anonymous"></script>

    <title th:text="#{home.title}">TITLE</title>
</head>
<body class="bg-light">

    <div th:include="navbar"></div>

    <div class="container">
        <div class="row justify-content-md-center">
            <div class="col-lg-12">

                <div class="mb-4 mt-4">
                    <h2 class="font-weight-bold text-center mb-4 mt-4 hide_me" th:text="${course.name}">COURSE NAME</h2>
                    <input id="name-input" type="text" class="input-group headline-edit show_me" style="display: none;" th:placeholder="${course.name}" th:value="${course.name}"></input>
                </div>

                <div class="container bg-light border border-dark rounded p-0">
                    <!--Delete Course-->
                    <form class="btn-delete" th:action="@{/course/delete}" method="post">
                        <input type="hidden" name="id" th:value="${course.id}"/>
                        <button type="submit" class="btn red-link btn-link" data-toggle="tooltip" data-placement="top" title="DELETE COURSE" th:title="#{detail.deleteCourse}"><i class="fas fa-trash-alt"></i></button>
                    </form>
                    <div class="row justify-content-md-center p-4">

                        <!--Course Details-->
                        <div class="col-md-6">
                            <form id="form" method="post" th:action="@{/course/edit?id={id}(id=${course.id})}" th:object="${form}">

                                <!--Name added into main form-->
                                <input id="hidden-name-input" type="text" style="display: none;" th:value="${course.name}" th:field="*{name}"></input>

                                <!--Headline & Buttons-->
                                <div class="row">
                                    <h5 class="font-weight-light text-left" th:text="#{course.details}">COURSE DETAILS</h5>
                                    <button type="button" id="startEdit" class="btn edit_details btn-link p-0 ml-4 align-middle" onclick="edit_mode()" data-toggle="tooltip" data-placement="right" th:title="#{detail.editCourse}"><i class="far fa-edit"></i></button>
                                    <button type="button" onClick="window.location.reload();" class="btn edit_details btn-link p-0 ml-4 align-middle show_me" style="display: none;" data-toggle="tooltip" data-placement="right" th:title="#{detail.cancelEdit}"><i class="fas fa-times"></i></button>
                                    <button type="submit" class="btn edit_details btn-link p-0 ml-4 align-middle show_me" style="display: none;" data-toggle="tooltip" data-placement="right" th:title="#{detail.finishEdit}"><i class="fas fa-check"></i></button>
                                </div>

                                <!--1st Table-->
                                <div class="row">
                                    <table class="table mb-4">
                                        <tbody>
                                            <!--Faculty-->
                                            <tr>
                                                <th scope="row" th:text="#{new.courseFaculty}">FACULTY NAME</th>
                                                <td class="hide_me" id="faculty_original"><span th:id="'og: ' + ${course.faculty}" th:text="#{'course.faculty.' + ${course.faculty}}">FACULTY</span></td>
                                                <td class="show_me" id="faculty_dropdown" style="display: none">
                                                    <select id="faculty_select" class="custom-select form-control" th:field="*{faculty}" th:with="faculties = ${T(qova.course.CourseFaculty).values()}">
                                                        <option class="dropdown-item" th:id="${faculty}" th:each="faculty : ${#lists.sort(faculties)}" th:text="#{'course.faculty.' + ${faculty}}" th:value="${faculty}">FACULTY</option>
                                                    </select>
                                                </td>
                                                <td></td>
                                            </tr>
                                            <!--Semester Period-->
                                            <tr>
                                                <th scope="row" th:text="#{course.courseInstance}">YEAR</th>
                                                <td class="hide_me" th:text="${course.semesterUI}">XXXX</td>
                                                <td class="show_me" style="display: none">
                                                    <select class="custom-select form-control" th:field="*{courseInstanceString}">
                                                        <option class="dropdown-item" th:each="year : ${semesterDates}" th:text="${year}" th:value="${year}">YEAR</option>
                                                    </select>
                                                </td>
                                                <td></td>
                                            </tr>
                                            <!--Semester of Students-->
                                            <tr>
                                                <th scope="row" th:text="#{course.semesterOfStudents}">SEMESTER</th>
                                                <td class="hide_me"><span th:text="${course.semesterOfStudents}">IDK - XXXX</span></td>
                                                <td class="show_me" style="display: none;">
                                                    <input class="form-control" type="text" th:placeholder="${course.semesterOfStudents}" th:field="*{semesterOfStudents}">
                                                </td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!--2nd Table-->
                                <div class="row">
                                    <table class="table mb-0">
                                        <thead>
                                            <tr>
                                                <th class="border-0 col-md-2 show_me" style="display: none;"></th>
                                                <th class="border-0 col-md-2" scope="col" th:text="#{detail.classType}">TYPE</th>
                                                <th class="border-0 text-center col-md-2" scope="col" data-toggle="tooltip" data-placement="top" title="AMOUNT" th:title="#{detail.classAmount}">#</th>
                                                <th class="border-0 text-center col-md-2" scope="col" th:text="#{detail.classSurvey}">SURVEY</th>
                                                <th class="border-0 hide_me"></th>
                                            </tr>
                                        </thead>
                                        <tbody>

                                            <!--Lecture-->
                                            <tr th:classappend="!${course.lectureExists} ? text-light-grey : userclass" id="lectureLine">
                                                <!--1st Col-->
                                                <td class="show_me" style="display: none;">
                                                    <div class="col-md-auto">
                                                        <label class="switch m-0 align-middle" th:switch="${course.lectureExists}">
                                                            <input th:case="FALSE" type="checkbox" id="lectureCheck" onclick="set_hidden_data('lecture')">
                                                            <input th:case="TRUE"  type="checkbox" id="lectureCheck" onclick="set_hidden_data('lecture')" checked>
                                                            <span class="slider round"></span>
                                                        </label>
                                                    </div>
                                                    <input th:if="!${course.lectureSurvey}" type="checkbox" id="lectureHidden" th:field="*{lectureExists}" hidden>
                                                    <input th:if="${course.lectureSurvey}"  type="checkbox" id="lectureHidden" th:field="*{lectureExists}" hidden checked>
                                                </td>
                                                <!--2nd Col-->
                                                <td scope="row" th:text="#{new.lecture}">LECTURE</td>
                                                <!--3rd Col-->
                                                <div th:switch="${course.lectureExists}">
                                                    <div th:case="TRUE">
                                                        <td class="text-center hide_me">1</td>
                                                        <td class="show_me" style="display: none;">
                                                            <input class="form-control" type="text" placeholder="1" min="0" max="1">
                                                        </td>
                                                    </div>
                                                    <div th:case="FALSE">
                                                        <td class="text-center hide_me">0</td>
                                                        <td class="show_me" style="display: none;">
                                                            <input class="form-control" type="text" placeholder="0" min="0" max="1">
                                                        </td>
                                                    </div>
                                                </div>
                                                <!--4th Col-->
                                                <div th:switch="${course.lectureSurvey}">
                                                    <div th:case="'[]'">
                                                        <td class="text-center" th:text="#{No}">!EXISTS</td>
                                                        <td th:switch="${course.lectureExists}">
                                                            <a th:case="TRUE" type="button" class="btn btn-link p-0 align-middle hide_me" th:href="${'/course/surveyeditor?type=LECTURE&id='  + {course.id}}" href="#" data-toggle="tooltip" data-placement="right" th:title="#{detail.addSurvey}"><i class="fas fa-plus"></i></a>
                                                        </td>
                                                    </div>
                                                    <div th:case="*">
                                                        <td class="text-center" id="lectureSurveyExists_original" th:text="#{Yes}">EXISTS</td>
                                                        <td th:switch="${course.lectureExists}">
                                                            <a th:case="TRUE" type="button" class="btn btn-link p-0 align-middle hide_me" th:href="${'/course/surveyeditor?type=LECTURE&id='  + {course.id}}" href="#" data-toggle="tooltip" data-placement="right" th:title="#{detail.editSurvey}"><i class="far fa-edit"></i></a>
                                                        </td>
                                                    </div>
                                                </div>
                                            </tr>

                                            <!--Tutorial-->
                                            <tr th:classappend="!${course.tutorialExists} ? text-light-grey : userclass" id="tutorialLine">
                                                <!--1st Col-->
                                                <td class="show_me" style="display: none;">
                                                    <div class="col-md-auto">
                                                        <label class="switch m-0 align-middle" th:switch="${course.tutorialExists}">
                                                            <input th:case="FALSE" type="checkbox" id="tutorialCheck" onclick="set_hidden_data('tutorial')">
                                                            <input th:case="TRUE"  type="checkbox" id="tutorialCheck" onclick="set_hidden_data('tutorial')" checked>
                                                            <span class="slider round"></span>
                                                        </label>
                                                    </div>
                                                    <input th:if="!${course.tutorialExists}" type="checkbox" id="tutorialHidden" th:field="*{tutorialExists}" hidden>
                                                    <input th:if="${course.tutorialExists}"  type="checkbox" id="tutorialHidden" th:field="*{tutorialExists}" hidden checked>
                                                </td>
                                                <!--2nd Col-->
                                                <td scope="row" th:text="#{new.tutorial}">TUTORIAL</td>
                                                <!--3rd Col-->
                                                <td class="text-center hide_me" th:text="${course.classTotalTutorial}">COUNT</td>
                                                <td class="show_me" style="display: none;">
                                                    <input class="form-control" type="text" th:field="*{classTotalTutorial}" th:placeholder="${course.classTotalTutorial}">
                                                </td>
                                                <!--4th Col-->
                                                <div th:switch="${course.tutorialSurvey}">
                                                    <div th:case="'[]'">
                                                        <td class="text-center" id="bool" th:text="#{No}">!EXISTS</td>
                                                        <td th:switch="${course.tutorialExists}">
                                                            <a th:case="TRUE" type="button" class="btn btn-link p-0 align-middle hide_me" th:href="${'/course/surveyeditor?type=TUTORIAL&id='  + {course.id}}" href="#" data-toggle="tooltip" data-placement="right" th:title="#{detail.addSurvey}"><i class="fas fa-plus"></i></a>
                                                        </td>
                                                    </div>
                                                    <div th:case="*">
                                                        <td class="text-center" id="bool" th:text="#{Yes}">EXISTS</td>
                                                        <td th:switch="${course.tutorialExists}">
                                                            <a th:case="TRUE" type="button" class="btn btn-link p-0 align-middle hide_me" th:href="${'/course/surveyeditor?type=TUTORIAL&id='  + {course.id}}" href="#" data-toggle="tooltip" data-placement="right" th:title="#{detail.editSurvey}"><i class="far fa-edit"></i></a>
                                                        </td>
                                                    </div>
                                                </div>
                                            </tr>

                                            <!--Seminar-->
                                            <tr th:classappend="!${course.seminarExists} ? text-light-grey : userclass" id="seminarLine">
                                                <!--1st Col-->
                                                <td class="show_me" style="display: none;">
                                                    <div class="col-md-auto">
                                                        <label class="switch m-0 align-middle" th:switch="${course.seminarExists}">
                                                            <input th:case="FALSE" type="checkbox" id="seminarCheck" onclick="set_hidden_data('seminar')">
                                                            <input th:case="TRUE"  type="checkbox" id="seminarCheck" onclick="set_hidden_data('seminar')" checked>
                                                            <span class="slider round"></span>
                                                        </label>
                                                    </div>
                                                    <input th:if="!${course.seminarExists}" type="checkbox" id="seminarHidden" th:field="*{seminarExists}" hidden>
                                                    <input th:if="${course.seminarExists}"  type="checkbox" id="seminarHidden" th:field="*{seminarExists}" hidden checked>
                                                </td>
                                                <!--2nd Col-->
                                                <td scope="row" th:text="#{new.seminar}">TUTORIAL</td>
                                                <!--3rd Col-->
                                                <td class="text-center hide_me" th:text="${course.classTotalSeminar}">COUNT</td>
                                                <td class="show_me" style="display: none;">
                                                    <input class="form-control" type="text" th:field="*{classTotalSeminar}" th:placeholder="${course.classTotalSeminar}">
                                                </td>
                                                <!--4th Col-->
                                                <div th:switch="${course.seminarSurvey}">
                                                    <div th:case="'[]'">
                                                        <td class="text-center" id="bool" th:text="#{No}">!EXISTS</td>
                                                        <td th:switch="${course.seminarExists}">
                                                            <a th:case="TRUE" type="button" class="btn btn-link p-0 align-middle hide_me" th:href="${'/course/surveyeditor?type=SEMINAR&id='  + {course.id}}" href="#" data-toggle="tooltip" data-placement="right" th:title="#{detail.addSurvey}"><i class="fas fa-plus"></i></a>
                                                        </td>
                                                    </div>
                                                    <div th:case="*">
                                                        <td class="text-center" id="bool" th:text="#{Yes}">EXISTS</td>
                                                        <td th:switch="${course.seminarExists}">
                                                            <a th:case="TRUE" type="button" class="btn btn-link p-0 align-middle hide_me" th:href="${'/course/surveyeditor?type=SEMINAR&id='  + {course.id}}" href="#" data-toggle="tooltip" data-placement="right" th:title="#{detail.editSurvey}"><i class="far fa-edit"></i></a>
                                                        </td>
                                                    </div>
                                                </div>
                                            </tr>

                                        </tbody>
                                    </table>
                                </div>

                            </form>
                        </div>

                        <div class="col-md-1"></div>

                        <!--QR Codes-->
                        <div class="col-md-auto">
                            <h5 class="font-weight-light text-center" th:text="#{detail.QR}">QR CODES</h5>
                            <div class="row justify-content-md-center">
                                <div class="container carousel-border border border-secondary p-1">
                                    <div id="carouselExampleIndicators" class="carousel slide" interval="false">
                                        <ol class="carousel-indicators">
                                            <li th:if="!${course.lectureSurvey.equals('[]')}" data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                                            <li th:if="!${course.tutorialSurvey.equals('[]')}" data-target="#carouselExampleIndicators" data-slide-to="1" th:classappend="${course.lectureSurvey.equals('[]')} ? active : userclass"></li>
                                            <li th:if="!${course.seminarSurvey.equals('[]')}" data-target="#carouselExampleIndicators" data-slide-to="2" th:classappend="${course.lectureSurvey.equals('[]') and course.tutorialSurvey.equals('[]')} ? active : userclass"></li>
                                        </ol>
                                        <div class="carousel-inner">
                                            <div th:if="!${course.lectureSurvey.equals('[]')}" class="carousel-item active">
                                                <img class="d-block w-100 mb-5" th:src="'data:image/jpeg;base64,' + ${LectureQRCode}" alt="Lecture slide">
                                                <div class="carousel-caption text-dark d-block mb-1">
                                                    <h5>Lecture</h5>
                                                </div>
                                            </div>
                                            <div th:if="!${course.tutorialSurvey.equals('[]')}" th:classappend="${course.lectureSurvey.equals('[]')} ? active : userclass" class="carousel-item">
                                                <img class="d-block w-100 mb-5" th:src="'data:image/jpeg;base64,' + ${TutorialQRCode}" alt="Tutorial slide">
                                                <div class="carousel-caption text-dark d-block mb-1">
                                                    <h5>Tutorial</h5>
                                                </div>
                                            </div>
                                            <div th:if="!${course.seminarSurvey.equals('[]')}" th:classappend="${course.lectureSurvey.equals('[]') and course.tutorialSurvey.equals('[]')} ? active : userclass" class="carousel-item">
                                                <img class="d-block w-100 mb-5" th:src="'data:image/jpeg;base64,' + ${SeminarQRCode}" alt="Seminar slide">
                                                <div class="carousel-caption text-dark d-block mb-1">
                                                    <h5>Seminar</h5>
                                                </div>
                                            </div>
                                            <div th:if="${course.lectureSurvey.equals('[]') and course.tutorialSurvey.equals('[]') and course.seminarSurvey.equals('[]')}" class="carousel-item active">
                                                <img class="d-block w-100 mb-5 bg-dark" src="..." alt="" style="width: 300px; height: 300px;">
                                                <div class="carousel-caption text-dark d-block mb-0">
                                                    <h5>No Surveys yet</h5>
                                                </div>
                                            </div>
                                        </div>
                                        <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                                            <span class="carousel-control-prev-icon" aria-hidden></span>
                                            <span class="sr-only">Previous</span>
                                        </a>
                                        <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                                            <span class="carousel-control-next-icon" aria-hidden></span>
                                            <span class="sr-only">Next</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <!--Download Button-->
                            <div class="container text-center mt-3">
                                <p class="m-0 font-weight-light" th:text="#{detail.download}"></p>
                                <div class="btn-group" role="group" aria-label="First group">
                                    <a th:if="!${course.lectureSurvey.equals('[]')}" class="btn btn-primary btn-sm" th:text="#{new.lecture}" th:href="${'/qrcode?type=LECTURE&id='  + {course.id}}" target="_blank" href="#">LECTURE</a>
                                    <a th:if="!${course.tutorialSurvey.equals('[]')}"  class="btn btn-primary btn-sm" th:text="#{new.tutorial}" th:href="${'/qrcode?type=TUTORIAL&id='  + {course.id}}" target="_blank" href="#">TUTORIAL</a>
                                    <a th:if="!${course.seminarSurvey.equals('[]')}"  class="btn btn-primary btn-sm" th:text="#{new.seminar}" th:href="${'/qrcode?type=SEMINAR&id='  + {course.id}}" target="_blank" href="#">SEMINAR</a>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>
    <div th:include="footer"></div>
</body>
<script>
    $( document ).ready(function() {
        $('[data-toggle="tooltip"]').tooltip(({trigger : 'hover'}));
    });

    function download_all() {
        const all_downloads = document.getElementsByClassName("download")
        for (let index = 0; index < all_downloads.length; ++index) {
            all_downloads[index].click();
        }
    }

    function set_hidden_data(type) {
        const hidden_input = document.getElementById(type + "Hidden");
        hidden_input.checked = document.getElementById(type + "Check").checked;
        if (hidden_input.checked === false) {
            document.getElementById(type + "Line").className = "text-light-grey";
        }
        else {
            document.getElementById(type + "Line").className = "";
        }
    };

    const name_input = document.getElementById("name-input")
    name_input.addEventListener("change", function() {
        document.getElementById("hidden-name-input").value  = name_input.value;
    });

    function sort_options(select_element) {
        const all_options = select_element.children;
        
        //sorting by innerHTML
        var sorted_option = [];
        for (let index = 0; index < all_options.length; ++index) {
            const option = all_options[index];
            sorted_option.push([option.id, option.innerHTML]);
        }
        sorted_option.sort(function(a, b) { 
            return a[1] > b[1] ? 1 : -1;
        });

        //resorting the options in the HTML
        for (let index = 0; index < all_options.length; ++index) {
            const new_child = select_element.querySelector("#" + sorted_option[index][0]);
            select_element.removeChild(new_child);
            select_element.appendChild(new_child);
        }
    }

    function switcheroo() {
        const vis = document.getElementsByClassName("hide_me");
        for (let index = 0; index < vis.length; ++index) {
            vis[index].style.display = "none";
        }
        const invis = document.getElementsByClassName("show_me");
        for (let index = 0; index < invis.length; ++index) {
            invis[index].style.display = "";
        }
    }
    
    function edit_mode() {
        //turns finish edit button visable & disables edit button
        document.getElementById("startEdit").disabled = true;

        //faculty replacement
        sort_options(document.getElementById("faculty_select"));
        const key = document.getElementById("faculty_original").querySelector("span").id;
        document.getElementById(key.slice(4, key.length)).setAttribute("selected", "selected");

        //replaces everything else
        switcheroo();        
    }
</script>
</html>